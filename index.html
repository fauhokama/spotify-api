<!DOCTYPE HTML>
<!--
	Multiverse by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Spotify Visualizer</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
	<script type="text/javascript">
		const queryString = window.location.hash;
		const urlParams = new URLSearchParams(queryString);
		const access_token = urlParams.get('#access_token')


		function addCode(title, img) {
			const html = `
				<article class="thumb">
					<a class="image" style="background-image: url(${img}); outline: currentcolor none 0px;">
					</a>
					<h2>${title}</h2>
				</article>`;

			document.getElementById("main").insertAdjacentHTML("beforeend", html);
		}

		async function getPlaylists(token) {
			const result = await fetch("https://api.spotify.com/v1/me/playlists", {
				method: 'GET',
				headers: {
					"Authorization": "Bearer " + token
				},
				redirect: 'follow'
			});

			if (result.status == 200) {

				document.getElementById("placeholder").remove();

				const data = await result.json();
				for (const playlist of data.items) {
					const title = playlist.name;
					const img = playlist.images[0].url;
					const addCodeVar = await addCode(title, img);
				}


			}
		}
		getPlaylists(access_token);




	</script>
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<h1><a><strong>Spotify Visualizer</strong> by fauhokama</a></h1>
			<nav>
				<ul>
					<a href="/login" style="color:rgb(28, 202, 28)" class="btn btn-primary">Log in with Spotify</a>
					<li><a href="/github" class="icon brands fa-github">Github</a></li>
				</ul>
			</nav>
		</header>

		<!-- Main -->
		<div id="main">
			<h2 id="placeholder"> Please, login with spotify</h2>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.poptrox.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

</body>

</html>